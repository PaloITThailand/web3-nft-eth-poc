trigger:
- main

pool:
  vmImage: ubuntu-latest

container: node:18-bullseye-slim@sha256:f32c970581a901560815b9af1aebbc164c86b9be922dda3b9f3b65f653e61776

variables:
- name: poc-directory
  value: .

steps:
# Set up and run hardhat backend tests
- script: |
    npm install
  displayName: 'Hardhat: Install hardhat dependencies'
  workingDirectory: $(poc-directory)

- script: |
    npx hardhat compile
  displayName: 'Hardhat: Compile smart contracts'
  workingDirectory: $(poc-directory)

- script: |
    npx hardhat test
  displayName: 'Hardhat: Test smart contracts'
  workingDirectory: $(poc-directory)

# Set up and run e2e tests
- script: |
    nohup npx hardhat node & > hardhat_node.log &
  displayName: 'Hardhat: run local ethereum node'
  workingDirectory: $(poc-directory)

- script: |
    npx hardhat --network localhost run scripts/deploy_palonft.js
  displayName: 'Hardhat: Deploy NFT smart contract'
  workingDirectory: $(poc-directory)

- script: |
    npm install
  displayName: 'Frontend: Install dependencies'
  workingDirectory: $(poc-directory)/frontend
